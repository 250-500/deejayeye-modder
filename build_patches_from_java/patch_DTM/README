DTM height computations instructions a.k.a. RTFM

This patch is a mix of Java code and "smali" code to integrate into existing application.

The modified app "smali" files are :

classes5/dji/pilot/fpv/SimpleAttitudeView.smali
classes5/dji/pilot/newfpv/WholeAttitudeView.smali

This part is provided as a "standard patch"

The java source code is in ./og directory
There is currently 2 java files, one responsible for handling 1 tile and the other one to handle a collection of tiles and interface to the app.

The DTM (digital terrain model) tiles must be downloaded from http://dwtkns.com/srtm30m/

once downloaded, you have to copy the tiles in the DJI/data/ directory of your phone/tablet/CrystalSky

the settings.json file must also be copied in the DJI/ directory of your phone/tablet/CrystalSky
the array of tiles file names must be modified to match the files you need.
Tiles are 1° latitude x 1° longitude which is about 100x100 km. Try don't using more than 4 tiles.

To build the smali code from the Java code, you will need :

Android SDK 
baksmali JAR :    https://bitbucket.org/JesusFreke/smali/downloads/baksmali-2.2.1.jar
Google GSON Jar : gson-2.8.3.jar available here : http://repo1.maven.org/maven2/com/google/code/gson/gson/2.8.3/

copy baksmali-2.2.1.jar and gson-2.8.3.jar in the same directory as java_to_smali.sh script
adjust script to match the path to the "dx" executable of your installation of Android SDK

run java_to_smali.sh

This will generate a "out" directory with the smali code matching the native java code.

Copy the full directory og/patch/.../ from the out directory to the apk decompiled directory (I did in classes5 subdir)

Apply the patch to modify 

classes5/dji/pilot/fpv/SimpleAttitudeView.smali
classes5/dji/pilot/newfpv/WholeAttitudeView.smali

so that they interface with the new code

Rebuild... play...

The current status is also provided as a regular "all inclusive patch" if you only want to use the feature. You would still have to download / copy the DTM tiles, the settings.json file, and modify this one to match your area...

You have to manually install this patch in your 4.1.22 patch folder... it's purposely not pre-installed so there is a chance you read this file if you plan to use it !


